<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.shape.SVGPath?>
<?import javafx.scene.text.Font?>

<StackPane xmlns:fx="http://javafx.com/fxml"
           fx:controller="tn.finhub.controller.AdminEscrowController"
           style="-fx-background-color: transparent;">

    <!-- VIEW 1: List View -->
    <VBox fx:id="listViewContainer" spacing="30" style="-fx-padding: 40 40 40 60; -fx-background-color: transparent;">
        
        <!-- Header & Summary Section -->
        <VBox spacing="20">
            <VBox spacing="5">
                <Label text="Escrow Management" styleClass="page-title"/>
                <Label text="Monitor and manage secure transactions" styleClass="page-subtitle"/>
            </VBox>

            <!-- Summary Cards -->
            <HBox spacing="20">
                <!-- Total -->
                <VBox styleClass="stat-card" HBox.hgrow="ALWAYS">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label styleClass="stat-icon-container" style="-fx-background-color: rgba(139, 92, 246, 0.1);">
                            <graphic>
                                <SVGPath content="M11.5 1L2 6v2h19V6l-9.5-5zM2 9v7h3V9H2zm6 0h3v7H8V9zm6 0h3v7h-3V9zM2 18v2h19v-2H2z" styleClass="stat-icon" style="-fx-fill: -color-primary;"/>
                            </graphic>
                        </Label>
                        <VBox>
                            <Label text="Total Escrows" styleClass="stat-label"/>
                            <Label fx:id="totalEscrowsLabel" text="0" styleClass="stat-value"/>
                        </VBox>
                    </HBox>
                </VBox>

                <!-- Active/Locked -->
                <VBox styleClass="stat-card" HBox.hgrow="ALWAYS">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label styleClass="stat-icon-container" style="-fx-background-color: rgba(59, 130, 246, 0.1);">
                            <graphic>
                                <SVGPath content="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z" styleClass="stat-icon" style="-fx-fill: -color-info;"/>
                            </graphic>
                        </Label>
                        <VBox>
                            <Label text="Active Locked" styleClass="stat-label"/>
                            <Label fx:id="activeEscrowsLabel" text="0" styleClass="stat-value"/>
                        </VBox>
                    </HBox>
                </VBox>

                <!-- Disputed -->
                <VBox styleClass="stat-card" HBox.hgrow="ALWAYS">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label styleClass="stat-icon-container" style="-fx-background-color: rgba(239, 68, 68, 0.1);">
                            <graphic>
                                <SVGPath content="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z" styleClass="stat-icon" style="-fx-fill: -color-error;"/>
                            </graphic>
                        </Label>
                        <VBox>
                            <Label text="Disputed" styleClass="stat-label"/>
                            <Label fx:id="disputedEscrowsLabel" text="0" styleClass="stat-value"/>
                        </VBox>
                    </HBox>
                </VBox>

                <!-- Released -->
                <VBox styleClass="stat-card" HBox.hgrow="ALWAYS">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label styleClass="stat-icon-container" style="-fx-background-color: rgba(16, 185, 129, 0.1);">
                            <graphic>
                                <SVGPath content="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" styleClass="stat-icon" style="-fx-fill: -color-success;"/>
                            </graphic>
                        </Label>
                        <VBox>
                            <Label text="Completed" styleClass="stat-label"/>
                            <Label fx:id="releasedEscrowsLabel" text="0" styleClass="stat-value"/>
                        </VBox>
                    </HBox>
                </VBox>
            </HBox>
        </VBox>

        <!-- List Container -->
        <VBox styleClass="content-card" VBox.vgrow="ALWAYS" style="-fx-padding: 0;">
            <ScrollPane fitToWidth="true" style="-fx-background-color: transparent; -fx-background: transparent;" VBox.vgrow="ALWAYS">
                <content>
                    <VBox fx:id="escrowListContainer" spacing="15" style="-fx-padding: 20;"/>
                </content>
            </ScrollPane>
        </VBox>
    </VBox>

    <!-- VIEW 2: Details View (Initially Hidden) -->
    <VBox fx:id="detailsViewContainer" visible="false" spacing="20" style="-fx-padding: 40 40 40 60; -fx-background-color: transparent;">
        <!-- Header with Back Button -->
        <HBox alignment="CENTER_LEFT" spacing="15">
            <Button onAction="#handleBack" styleClass="button-icon" style="-fx-background-color: -color-bg-subtle; -fx-background-radius: 50%;">
                <graphic>
                    <SVGPath content="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" style="-fx-fill: -color-text-primary;" scaleX="1.2" scaleY="1.2"/>
                </graphic>
            </Button>
            <VBox>
                <Label text="Escrow Details" styleClass="page-title"/>
                <Label fx:id="detailIdLabel" text="#ID" styleClass="page-subtitle"/>
            </VBox>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="detailStatusLabel" text="STATUS" style="-fx-font-weight: bold; -fx-padding: 5 10; -fx-background-radius: 4;"/>
        </HBox>

        <HBox spacing="30" VBox.vgrow="ALWAYS">
            <!-- Left Column: Transaction Details -->
            <VBox spacing="20" HBox.hgrow="ALWAYS" styleClass="content-card" style="-fx-padding: 30;">
                <Label text="Transaction Information" styleClass="section-header" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                
                <HBox spacing="50">
                    <VBox spacing="5">
                        <Label text="Amount" styleClass="text-muted"/>
                        <Label fx:id="detailAmountLabel" text="0.000 TND" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: -color-primary;"/>
                    </VBox>
                    <VBox spacing="5">
                        <Label text="Type" styleClass="text-muted"/>
                        <Label fx:id="detailTypeLabel" text="QR_CODE" styleClass="text-default" style="-fx-font-size: 16px;"/>
                    </VBox>
                </HBox>

                <VBox spacing="5">
                   <Label text="Condition" styleClass="text-muted"/>
                   <Label fx:id="detailConditionLabel" text="Condition text..." wrapText="true" style="-fx-font-style: italic; -fx-font-size: 14px;"/>
                </VBox>

                <Separator/>

                <HBox spacing="50">
                     <VBox spacing="5">
                        <Label text="From (Sender)" styleClass="text-muted"/>
                        <Label fx:id="detailSenderLabel" text="Sender Name" styleClass="text-default" style="-fx-font-weight: bold;"/>
                    </VBox>
                    <VBox alignment="CENTER">
                        <SVGPath content="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z" style="-fx-fill: -color-text-muted;"/>
                    </VBox>
                    <VBox spacing="5">
                        <Label text="To (Receiver)" styleClass="text-muted"/>
                        <Label fx:id="detailReceiverLabel" text="Receiver Name" styleClass="text-default" style="-fx-font-weight: bold;"/>
                    </VBox>
                </HBox>
                
                <Separator/>
                
                <Label text="Administrative Actions" styleClass="section-header" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                <HBox spacing="15">
                    <Button fx:id="btnRelease" text="Release Funds to Receiver" onAction="#handleDetailRelease" styleClass="button-success"/>
                    <Button fx:id="btnRefund" text="Refund to Sender" onAction="#handleDetailRefund" styleClass="button-danger"/>
                </HBox>
            </VBox>

            <!-- Right Column: Timeline/Metadata -->
            <VBox spacing="20" prefWidth="300" styleClass="content-card" style="-fx-padding: 30;">
                <Label text="Metadata" styleClass="section-header" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                
                <VBox spacing="5">
                    <Label text="Created At" styleClass="text-muted"/>
                    <Label fx:id="detailDateLabel" text="2023-10-27 10:30" styleClass="text-default"/>
                </VBox>

                <VBox spacing="5">
                    <Label text="Blockchain Hash" styleClass="text-muted"/>
                    <Label text="0x7f...3a2" styleClass="text-default" style="-fx-font-family: 'Monospaced';"/>
                </VBox>
                
                <Region VBox.vgrow="ALWAYS"/>
                <Button text="View Blockchain Record" styleClass="button-outlined"/>
            </VBox>
        </HBox>
    </VBox>

</StackPane>
